-- Add extraction rules to admin_ai_memory_config table
-- These control what the AI should/shouldn't extract from conversations

ALTER TABLE admin_ai_memory_config
  ADD COLUMN IF NOT EXISTS skip_relative_facts BOOLEAN DEFAULT true,
  ADD COLUMN IF NOT EXISTS skip_keywords TEXT[] DEFAULT ARRAY[
    'اسم', 'اسمه', 'اسمها', 'يدعى', 'تدعى',
    'والد', 'والدة', 'أب', 'أم', 'جد', 'جدة',
    'أخ', 'أخت', 'إخوة', 'أخوات',
    'عم', 'عمة', 'خال', 'خالة',
    'ابن', 'ابنة', 'أبناء', 'بنات',
    'زوج', 'زوجة'
  ],
  ADD COLUMN IF NOT EXISTS extraction_instructions_ar TEXT DEFAULT
'⚠️ هام جداً - لا تستخرج هذه المعلومات (موجودة بالفعل في قاعدة البيانات):
- أسماء الأقارب (الأب، الأم، الإخوة، الجد، الجدة، إلخ)
- نوع صلة القرابة (والد، والدة، أخ، أخت، عم، خال، إلخ)
- معلومات أساسية عن الأقارب موجودة في ملفاتهم

✅ استخرج فقط:
- تفضيلات شخصية للمستخدم (أسلوب تواصله، اهتماماته، شخصيته)
- تواريخ مهمة جديدة (مناسبات، ذكريات، أحداث قادمة)
- مشاعر أو مخاوف أو أهداف عبّر عنها المستخدم',
  ADD COLUMN IF NOT EXISTS extraction_examples_ignore TEXT[] DEFAULT ARRAY[
    'اسم والد المستخدم محمد',
    'أم المستخدم اسمها فاطمة',
    'لديه أخ اسمه أحمد',
    'جده/جدته اسمه...'
  ],
  ADD COLUMN IF NOT EXISTS extraction_examples_extract TEXT[] DEFAULT ARRAY[
    'يفضل التواصل صباحاً',
    'يشعر بالذنب لعدم زيارة جدته',
    'ذكرى زواج والديه في شهر رجب',
    'يجد صعوبة في التحدث عن مشاعره',
    'يريد تحسين علاقته بأبيه'
  ];

-- Update existing row with defaults
UPDATE admin_ai_memory_config
SET
  skip_relative_facts = true,
  skip_keywords = ARRAY[
    'اسم', 'اسمه', 'اسمها', 'يدعى', 'تدعى',
    'والد', 'والدة', 'أب', 'أم', 'جد', 'جدة',
    'أخ', 'أخت', 'إخوة', 'أخوات',
    'عم', 'عمة', 'خال', 'خالة',
    'ابن', 'ابنة', 'أبناء', 'بنات',
    'زوج', 'زوجة'
  ],
  extraction_instructions_ar = '⚠️ هام جداً - لا تستخرج هذه المعلومات (موجودة بالفعل في قاعدة البيانات):
- أسماء الأقارب (الأب، الأم، الإخوة، الجد، الجدة، إلخ)
- نوع صلة القرابة (والد، والدة، أخ، أخت، عم، خال، إلخ)
- معلومات أساسية عن الأقارب موجودة في ملفاتهم

✅ استخرج فقط:
- تفضيلات شخصية للمستخدم (أسلوب تواصله، اهتماماته، شخصيته)
- تواريخ مهمة جديدة (مناسبات، ذكريات، أحداث قادمة)
- مشاعر أو مخاوف أو أهداف عبّر عنها المستخدم',
  extraction_examples_ignore = ARRAY[
    'اسم والد المستخدم محمد',
    'أم المستخدم اسمها فاطمة',
    'لديه أخ اسمه أحمد',
    'جده/جدته اسمه...'
  ],
  extraction_examples_extract = ARRAY[
    'يفضل التواصل صباحاً',
    'يشعر بالذنب لعدم زيارة جدته',
    'ذكرى زواج والديه في شهر رجب',
    'يجد صعوبة في التحدث عن مشاعره',
    'يريد تحسين علاقته بأبيه'
  ]
WHERE config_key = 'default';
